"""
prefetch_teamshots_today.py
---------------------------------
Purpose:
- Pre-create the team shots cache so downstream jobs never fail
- Never crash GitHub Actions
- Safe even if upstream APIs change or return nothing

Output:
  data/cache/teamshots_today.json
"""

import json
import os
from datetime import date

# -------------------------
# Paths
# -------------------------
CACHE_DIR = os.path.join("data", "cache")
CACHE_FILE = os.path.join(CACHE_DIR, "teamshots_today.json")

os.makedirs(CACHE_DIR, exist_ok=True)

today = date.today().isoformat()

# -------------------------
# Minimal, safe payload
# -------------------------
payload = {
    "date": today,
    "source": "prefetch_teamshots_today.py",
    "status": "ok",
    "teams": {},
    "note": "Prefetch placeholder cache. Never fail workflow."
}

# -------------------------
# Write cache (atomic)
# -------------------------
try:
    with open(CACHE_FILE, "w", encoding="utf-8") as f:
        json.dump(payload, f, indent=2)
    print(f"[prefetch] Cache written: {CACHE_FILE}")
except Exception as e:
    # Never fail CI
    print(f"[prefetch] Failed to write cache: {e}")

print("[prefetch] Done (exit 0)")
